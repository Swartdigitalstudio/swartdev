var bit_advanced_file_up_field=function(){"use strict";return class{#e=null;#i=null;#t=null;#s=null;#l={};#n=null;#a=null;#o=null;#d=null;#r=null;#h=null;#p=[];#f={document:{},formID:null,configSetting:{},ajaxURL:null,nonce:null,uploadFileToServer:null};constructor(e,i){Object.assign(this.#f,i),this.#n=i.fieldKey,this.#s=i.window?i.window:window,this.#t=i.document?i.document:document,this.#e="string"==typeof e?this.#t.querySelector(e):e,this.#a=this.#f.formID,this.#l=this.#f.configSetting,this.#o=this.#f.ajaxURL,this.#d=this.#f.nonce,this.#r=this.#f.uploadFileToServer,this.uploaded_files=[],this.on_select_upload=!1,this.init()}init(){this.files=[];const e=[];this.#l.allowFileSizeValidation&&e.push(this.#s.bit_filepond_plugin_file_validate_size),this.#l.allowFileTypeValidation&&e.push(this.#s.bit_filepond_plugin_file_validate_type),this.#l.allowImageCrop&&e.push(this.#s.bit_filepond_plugin_image_crop),this.#l.allowImagePreview&&e.push(this.#s.bit_filepond_plugin_image_preview),this.#l.allowImageResize&&e.push(this.#s.bit_filepond_plugin_image_resize),this.#l.allowImageTransform&&e.push(this.#s.bit_filepond_plugin_image_transform),this.#l.allowImageValidateSize&&e.push(this.#s.bit_filepond_plugin_image_validate_size),this.#l.allowPreview&&e.push(this.#s.bit_filepond_plugin_media_preview);const{create:i,registerPlugin:t}=this.#s.bit_filepond;if(t(...e),this.#i=i(this.#l),this.#e.appendChild(this.#i.element),setTimeout((()=>{this.#e&&this.#e.parentNode.parentNode.querySelector(`.${this.#n}-lbl`).setAttribute("for",this.#c('input[name="filepond"]').id)}),1e3),this.#f.onFileUpdate&&this.#i.on("updatefiles",this.#f.onFileUpdate),this.#r){const e=new URL(this.#o);this.on_select_upload=this.#l.instantUpload,e.searchParams.append("_ajax_nonce",this.#d);let i=null;this.#i.setOptions({server:{process:(t,s,l,n,a,o,d)=>{const r=new FormData;e.searchParams.has("action")&&e.searchParams.delete("action"),e.searchParams.append("action","bitforms_file_upload"),r.append(this.#n,s,s.name),r.append("fieldKey",this.#n),r.append("formID",this.#a);const h=new XMLHttpRequest;return h.open("POST",e.href),h.upload.onprogress=e=>{o(e.lengthComputable,e.loaded,e.total)},h.onload=()=>{i=JSON.parse(h.responseText),h.status>=200&&h.status<300?(this.uploaded_files.push(i?.data?.file_name),n(i?.data?.file_name)):a()},h.send(r),{abort:()=>{h.abort(),d()}}},revert:(i,t,s)=>{if(this.uploaded_files.find((e=>e===i))){const l=this.uploaded_files.indexOf(i);this.uploaded_files.splice(l,1),e.searchParams.has("action")&&e.searchParams.delete("action"),e.searchParams.append("action","bitforms_file_delete"),e.searchParams.append("file_name",i);const n=new XMLHttpRequest;return n.open("DELETE",e.href),n.onload=()=>{n.status>=200&&n.status<300?t():s()},n.send(),{abort:()=>{n.abort()}}}}},labelFileProcessingError:()=>i?.data}),this.#i.on("updatefiles",(()=>{this.files=[],this.files=this.#i.getFiles()}))}this.#f.oldFiles&&this.#u(this.#f.oldFiles)}#u(e){const i=JSON.parse(e);this.#p=JSON.parse(e),this.#h=this.#g("div"),this.#m(this.#h,"old-file-list"),i.forEach((e=>{this.#_(e)}));const t=this.#g("input");t.type="hidden",t.name=`${this.#n}_old`,t.value=this.#p.toString(),this.#e.appendChild(this.#h),this.#e.appendChild(t)}#_(e){const i=this.#g("div"),t=e.replace(/( |\.|\(|\))/g,"");i.id=`file-wrp-${t}`,this.#m(i,"file-wrpr");const s=this.#g("div");this.#m(s,"file-details");const l=this.#g("a");this.#m(l,"file-title"),this.#w(l,"target","_blank"),this.#w(l,"href",`${this.#f.baseDLURL}&fileID=${e}`),this.#b(l,e),s.append(l),i.append(s);const n=this.#g("button");this.#m(n,"cross-btn"),this.#w(n,"data-file-id",t),this.#w(n,"data-file-name",e),this.#w(n,"type","button"),this.#b(n,"Ã—"),this.#F(n,"click",(e=>this.#v(e))),i.append(n),this.#h.appendChild(i)}#v(e){const i=e.target.getAttribute("data-file-id"),t=e.target.getAttribute("data-file-name");this.#S(`#file-wrp-${i}`),this.#p=this.#p.filter((e=>e!==t)),this.#c(`input[name="${this.#n}_old"]`).value=this.#p.toString()}#S(e){this.#c(e)?.remove()}#g(e){return this.#t.createElement(e)}#F(e,i,t){e.addEventListener(i,t)}#m(e,i){e.classList.add(i)}#b(e,i){e.textContent=i}#w(e,i,t){e?.setAttribute?.(i,t)}#c(e){return this.#e.querySelector(e)||void 0}reset(){this.#i.destroy(this.#i.element),this.#e.innerHTML="",this.init()}}}();
