var bit_razorpay_field=function(){"use strict";return class{#e=null;#t="";#n={clientId:"",options:{currency:"INR",amount:1,amountType:"fixed",theme:{},modal:{},prefill:{},notes:{}}};#i=null;#o=null;#s=null;constructor(e,t){Object.assign(this.#n,t),this.#o=t.document||document,this.#s=t.window||window,this.#t=`#form-${this.#r()}`,this.#e="string"==typeof e?this.#o.querySelector(e):e,this.init()}init(){this.#a(this.#c(`.${this.#n.fieldKey}-razorpay-btn`),"click",(()=>{this.#l()}))}#c(e,t){return t?this.#o.querySelector(t).querySelector(e):this.#e.querySelector(e)}#a(e,t,n){e.addEventListener(t,n)}#d(e,t,n){e.removeEventListener(t,n)}#y(e){if(e){const t=window.bf_globals[this.#r()].fields[e].fieldName;let n=this.#c(`[name="${t}"]`,this.#t);if(n&&"radio"===n.type&&(n=this.#c(`[name="${t}"]:checked`,this.#t)),n&&n.value)return n.value}return""}#m=e=>{const t=document.getElementById(`${this.#r()}`);t.classList.add("pos-rel","form-loading");const n=document.getElementById(`form-${this.#r()}`),i=this.#r()?.split("_")[1];if(null!=n){const o=bf_globals[this.#r()];this.#i&&(o.entryId=this.#i);const s=bfSelect(`input[name="${this.#n.fieldKey}"]`,n);s?s.value=e.razorpay_payment_id:setHiddenFld({name:this.#n.fieldKey,value:e.razorpay_payment_id,type:"text"},n);let r=bfSelect('button[type="submit"]',n);r||(r=document.createElement("button"),r.setAttribute("type","submit"),r.style.display="none",n.append(r)),r.click();const a={formID:i,fieldKey:this.#n.fieldKey,transactionID:e.razorpay_payment_id,payment_type:"subscription"===this.#n.payType?"subscription":"order",entry_id:this.#i},c=new URL(o?.ajaxURL);c.searchParams.append("_ajax_nonce",o?.nonce),c.searchParams.append("action","bitforms_save_razorpay_details"),fetch(c,{method:"POST",body:JSON.stringify(a)}).then((()=>{t.classList.remove("pos-rel","form-loading"),this.#i=null}))}};async#l(){const{currency:e,amount:t,amountType:n,amountFld:i,name:o,description:s,theme:r,prefill:a,modal:c,notes:l}=this.#n.options,{confirm_close:d}=c,{contentId:y}=this.#n,m=100*Number("dynamic"===n?this.#y(i):t),p={key:this.#n.clientId,currency:e,amount:m,name:o,description:s,theme:r,prefill:{name:this.#y(a.prefillNameFld),email:this.#y(a.prefillEmailFld),contact:this.#y(a.prefillContactFld)},notes:l,modal:{backdropclose:!1,escape:!1,confirm_close:d},handler:async e=>this.#m(e)};try{await isFormValidatedWithoutError(y)}catch(e){return!1}const h=await saveFormProgress(y),u=h?.[y];u?.success&&(u.entry_id&&(this.#i=u.entry_id),new this.#s.Razorpay(p).open())}#r(){return this.#n.contentId}destroy(){this.#d(this.#c(`.${this.#n.fieldKey}-razorpay-btn`),"click",(()=>{this.#l()}))}reset(){this.destroy(),this.init()}}}();
